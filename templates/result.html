{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link href="{% static 'css/result.css' %}" rel="stylesheet">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
      
        gtag('config', 'G-VVGHEKP370');
      </script>
</head>

<body>
    <div class="result-container">
        <h1>ğŸ‰ Your Health Results Are Ready! ğŸ‰</h1>
        <h2>Key Health Numbers</h2>

    <!-- result.html - Update the parameters -->
            
    <div class="result-item">
        <strong>ğŸ“ BMI:</strong> 
        <span class="text-danger" id="bmi">{{ metrics.bmi|floatformat:2 }}</span>
        (<span id="bmiCategory">{{ metrics.bmi_category }}</span>)
    </div>
            <div class="result-item"><strong>ğŸ”¥ BMR:</strong> <span class="text-danger">{{ metrics.bmr }}</span> kcal</div>
            <div class="result-item"><strong>âš¡ TDEE:</strong> <span class="text-danger">{{ metrics.tdee }}</span> kcal</div>
            <div class="result-item"><strong>âš–ï¸ IBW:</strong> <span class="text-danger">{{ metrics.ibw }}</span></div>
            <div class="result-item"><strong>â¤ï¸ MHR:</strong> <span class="text-danger">{{ metrics.mhr }}</span> bpm</div>


        <hr>

        <div class="mt-5">
            <h3 class="mb-3">ğŸ“Š Health Progress Over Time</h3>
            <div class="mb-4">
                <h4 class="mb-2 font-semibold">Toggle Metrics:</h4>
                <label class="mr-4"><input type="checkbox" class="metric-toggle" data-metric="BMI" checked> BMI</label>
                <label class="mr-4"><input type="checkbox" class="metric-toggle" data-metric="BMR" checked> BMR</label>
                <label class="mr-4"><input type="checkbox" class="metric-toggle" data-metric="TDEE" checked> TDEE</label>
                <label class="mr-4"><input type="checkbox" class="metric-toggle" data-metric="MHR" checked> MHR</label>
            </div>
            
            <canvas id="healthProgressChart" width="100%" height="50"></canvas>
            
        </div>


        <hr>
        

        <h3>What These Numbers Mean</h3>
        <p><strong>ğŸ“ BMI (Body Mass Index):</strong> A measure of body fat based on height & weight. A healthy range is <span class="text-danger">18.5 - 24.9</span>.</p>
        <p><strong>ğŸ”¥ BMR (Basal Metabolic Rate):</strong> Calories needed for basic body functions at rest.</p>
        <p><strong>âš¡ TDEE (Total Daily Energy Expenditure):</strong> The total calories burned daily, including activity.</p>
        <p><strong>âš–ï¸ IBW (Ideal Body Weight):</strong> The healthy weight range for your height.</p>
        <p><strong>â¤ï¸ MHR (Maximum Heart Rate):</strong> The max safe heart rate during exercise, based on age.</p>

        <a href="{% url 'calculator' %}" class="button-result">ğŸ”™ Go Back</a>
    </div>

    <!--<script src="{% static 'js/result.js' %}"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
   
    const chartData = {{ chart_data|safe }};
    const lastIndex = chartData.dates.length - 1;

    const colors = {
        BMI: 'rgba(255, 99, 132, 1)',
        BMR: 'rgba(54, 162, 235, 1)',
        TDEE: 'rgba(255, 206, 86, 1)',
        MHR: 'rgba(75, 192, 192, 1)'
    };

    const datasets = ['BMI', 'BMR', 'TDEE', 'MHR'].map((metric, index) => ({
        label: metric,
        data: chartData[metric.toLowerCase()],
        borderColor: colors[metric],
        backgroundColor: colors[metric].replace('1)', '0.1)'),
        tension: 0.4,
        fill: true,
        pointRadius: (ctx) => ctx.dataIndex === lastIndex ? 6 : 3,
        pointBackgroundColor: (ctx) => ctx.dataIndex === lastIndex ? colors[metric] : 'white',
        hidden: false
    }));

    // Custom plugin to draw BMI target range
    const bmiTargetPlugin = {
        id: 'bmiTargetRange',
        beforeDraw(chart) {
            const yAxis = chart.scales.y;
            const ctx = chart.ctx;
            const top = yAxis.getPixelForValue(24.9);
            const bottom = yAxis.getPixelForValue(18.5);
            ctx.save();
            ctx.fillStyle = 'rgba(0, 255, 0, 0.08)';
            ctx.fillRect(chart.chartArea.left, top, chart.chartArea.right - chart.chartArea.left, bottom - top);
            ctx.restore();
        }
    };

    const config = {
        type: 'line',
        data: {
            labels: chartData.dates,
            datasets: datasets
        },
        options: {
            responsive: true,
            interaction: {
                mode: 'index',
                intersect: false
            },
            stacked: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Health Metrics Over Time'
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    title: {
                        display: true,
                        text: 'Metric Value'
                    }
                }
            }
        },
        plugins: [bmiTargetPlugin]
    };

    const ctx = document.getElementById('healthProgressChart').getContext('2d');
    const healthChart = new Chart(ctx, config);

    // Toggle metric visibility
    document.querySelectorAll('.metric-toggle').forEach(input => {
        input.addEventListener('change', () => {
            const metric = input.dataset.metric;
            const dataset = healthChart.data.datasets.find(d => d.label === metric);
            dataset.hidden = !input.checked;
            healthChart.update();
        });
    });


</script>

</body>
</html>
